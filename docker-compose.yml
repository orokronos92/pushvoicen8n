version: '3.8'

services:
  pushvoice-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pushvoice-app
    restart: unless-stopped
    ports:
      - "3001:3000"  # Port différent pour éviter les conflits
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_WS_URL=wss://pushvoice.srv801583.hstgr.cloud
      - JWT_SECRET=pushvoice-secret-key-very-long-and-complex-2025
      - N8N_WEBHOOK_URL=https://n8n.srv801583.hstgr.cloud/webhook-test/8d3b3e9f-2c90-4fc4-b1f5-33653ae0b17c
      - N8N_API_KEY=lamangueverteestmure
    volumes:
      - ./logs:/app/logs
    networks:
      - root_default  # Réseau Traefik existant
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.pushvoice.rule=Host(`pushvoice.srv801583.hstgr.cloud`)"
      - "traefik.http.routers.pushvoice.entrypoints=websecure"
      - "traefik.http.routers.pushvoice.tls.certresolver=mytlschallenge"
      - "traefik.http.services.pushvoice.loadbalancer.server.port=3000"

networks:
  root_default:
    external: true